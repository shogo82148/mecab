name: mecab on MinGW

on:
  pull_request:
    paths:
      - ".github/workflows/test-mingw.yml"
      - "mecab/**"
  push:
    branches:
      - master
    paths:
      - ".github/workflows/test-mingw.yml"
      - "mecab/**"

jobs:
  test:
    name: Test
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v2
      - name: Set ENV
        run: |
          # MSYS2 is pre-installed from https://github.com/actions/virtual-environments/releases/tag/win19%2F20200608.1
          # but not added to PATH.
          # so, we need to add it to PATH here.
          echo '::set-env name=PATH::C:\msys64\bin;C:\msys64\usr\bin;C:\msys64\mingw64\bin;'
      - name: setup MSYS2
        run: |
          pacman-key --init
          pacman-key --populate msys2
          pacman.exe -Sy
          pacman.exe -S --verbose --noconfirm --noprogressbar --needed autoconf bison make automake1.16 automake-wrapper mingw-w64-x86_64-gcc mingw-w64-x86_64-libtool
        shell: bash.exe --noprofile --norc -e -o pipefail {0}
      - name: configure
        run: |
          ./autogen.sh
          ./configure --host=x86_64-w64-mingw32
        shell: bash.exe --noprofile --norc -e -o pipefail {0}
        working-directory: mecab
      - name: make
        run: |
          make all
          make check
          make install
        shell: bash.exe --noprofile --norc -e -o pipefail {0}
        working-directory: mecab

      - name: build ipadic
        run: |
          ./autogen.sh
          ./configure --with-charset=utf8
          make all
          make install
        shell: bash.exe --noprofile --norc -e -o pipefail {0}
        working-directory: mecab-ipadic
